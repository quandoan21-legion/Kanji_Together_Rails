<div class="card shadow mb-4">
  <div class="card-body p-0">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
      <h6 class="m-0 font-weight-bold text-primary">Quản lý duyệt bài (Câu chuyện)</h6>

      <div class="card-tools">
        <%= form_with url: admin_stories_path, method: :get, class: "form-inline", local: true do |f| %>
          <div class="input-group input-group-sm">
            <%= f.select :status,
                         [['Tất cả trạng thái', ''], ['Chờ duyệt', 'pending'], ['Đã duyệt', 'approved'], ['Bị từ chối', 'rejected']],
                         { selected: params[:status] },
                         { class: "form-control mr-2 custom-select", onchange: "this.form.submit();" }
            %>

            <%# --- THAY ĐỔI: Input nhập Kanji thay vì Email --- %>
            <%= f.text_field :kanji,
                             placeholder: "Nhập chữ Kanji...",
                             class: "form-control mr-2",
                             value: params[:kanji] %>

            <div class="input-group-append">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover table-striped mb-0">
        <thead class="thead-light">
        <tr>
          <th>ID</th>
          <th>Chữ Kanji</th>
          <th>Người tạo</th>
          <th>Trạng thái</th>
          <th class="text-center">Hành động</th>
        </tr>
        </thead>
        <tbody>
        <% if @stories.present? %>
          <% @stories.each do |story| %>
            <tr>
              <td class="align-middle">#<%= story["id"] %></td>

              <td class="align-middle">
                  <span class="badge badge-light border text-primary" style="font-size: 1.2rem;">
                    <%= story["kanji_text"] || story["kanji"] || "?" %>
                  </span>
              </td>

              <td class="align-middle">
                <i class="fas fa-user-circle text-gray-400 mr-1"></i>
                <%= story["user_email"] || story["email"] || "Ẩn danh" %>
              </td>

              <td class="align-middle">
                <%
                  status_class = case story["status"]
                                 when 'approved' then 'badge-success'
                                 when 'rejected' then 'badge-danger'
                                 else 'badge-warning' # pending
                                 end

                  status_label = case story["status"]
                                 when 'approved' then 'ĐÃ DUYỆT'
                                 when 'rejected' then 'TỪ CHỐI'
                                 else 'CHỜ DUYỆT'
                                 end
                %>
                <span class="badge <%= status_class %> px-2 py-1">
                  <%= status_label %>
                </span>
              </td>

              <td class="text-center align-middle">
                <%= link_to admin_story_path(story["id"]),
                            class: "btn btn-info btn-sm shadow-sm",
                            data: { turbo: false } do %>
                  <i class="fas fa-edit mr-1"></i> Vào duyệt
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="5" class="text-center py-5 text-muted">
              <i class="fas fa-inbox fa-3x mb-3 text-gray-300"></i><br>
              Không tìm thấy câu chuyện nào phù hợp.
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>