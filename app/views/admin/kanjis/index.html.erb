<div class="row">
  <div class="col-12">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <h3 class="card-title font-weight-bold">
          <i class="fas fa-book-open mr-1"></i> Danh sách Kanji hệ thống (Từ Java)
        </h3>
        <div class="card-tools">
          <%= link_to new_admin_kanji_path, class: "btn btn-success btn-sm elevation-2" do %>
            <i class="fas fa-plus-circle"></i> Thêm Kanji mới
          <% end %>
        </div>
      </div>

      <div class="card-body table-responsive p-0">
        <table class="table table-hover table-bordered mb-0">
          <thead class="bg-light">
          <tr class="text-center align-middle">
            <th style="width: 50px;">Chữ</th>
            <th>Hán Việt</th>
            <th>Nghĩa</th>
            <th style="width: 50px;">JLPT</th>
            <th>Âm (On/Kun)</th>
            <th style="width: 50px;">Nét</th>
            <th style="width: 180px;">Bộ thủ & Thành phần</th>
            <th style="width: 250px;">Câu chuyện</th>
            <th style="width: 300px;">Mở rộng (Từ vựng/Ví dụ)</th>
            <th style="width: 70px;">Ảnh</th>
            <th style="width: 100px; white-space: nowrap;">Hành động</th>
          </tr>
          </thead>
          <tbody>
          <% @kanjis.each do |kanji| %>
            <tr class="align-middle">
              <td class="text-center align-middle">
                <span class="text-bold text-lg" style="color: #007bff; font-size: 1.5rem;">
                  <%= kanji["kanji"] %>
                </span>
              </td>

              <td class="text-center align-middle text-uppercase font-weight-bold">
                <%= kanji["translation"]&.split(/\R/)&.reject(&:blank?)&.join(", ") %>
              </td>

              <td class="align-middle">
                <%= kanji["meaning"] %>
              </td>

              <td class="text-center align-middle">
                <span class="badge badge-info shadow-sm">N<%= kanji["jlpt"] %></span>
              </td>

              <td class="align-middle">
                <div class="small">
                  <strong class="text-secondary">On:</strong>
                  <%= kanji["on_pronunciation"]&.gsub(/\R/, " | ") %><br>
                  <strong class="text-secondary">Kun:</strong>
                  <%= kanji["kun_pronunciation"]&.gsub(/\R/, " | ") %>
                </div>
              </td>

              <td class="text-center align-middle">
                <span class="badge badge-light border"><%= kanji["num_strokes"] %></span>
              </td>

              <td class="align-middle">
                <div class="mb-1">
                  <strong>Bộ thủ:</strong> <%= kanji["radical"] %>
                </div>

                <% if kanji["components"].present? %>
                  <div>
                    <strong>Thành phần:</strong>
                    <%= kanji["components"].split(/\R/).reject(&:blank?).join(", ") %>
                  </div>
                <% end %>
              </td>

              <td class="align-middle">
                <div class="bg-light rounded p-2 border" style="max-height: 100px; overflow-y: auto; font-size: 0.85rem;">
                  <%= kanji["kanji_description"].present? ? simple_format(kanji["kanji_description"]) : "Chưa có" %>
                </div>
                <div class="contribution-info mt-1">
                  <%= link_to admin_stories_path(kanji_id: kanji["id"]), class: "btn btn-xs btn-outline-info btn-block" do %>
                    <i class="fas fa-tasks"></i> Quản lý
                  <% end %>
                </div>
              </td>

              <td class="align-middle small">
                <div style="max-height: 120px; overflow-y: auto;">
                  <% if kanji["vocabulary"].present? %>
                    <div class="mb-2">
                      <strong class="text-success"><i class="fas fa-language"></i> Từ vựng:</strong><br>
                      <%= kanji["vocabulary"].gsub(/\R/, "<br>").html_safe %>
                    </div>
                  <% end %>

                  <% if kanji["examples"].present? %>
                    <div>
                      <strong class="text-info"><i class="fas fa-quote-left"></i> Ví dụ:</strong><br>
                      <%= kanji["examples"].gsub(/\R/, "<br>").html_safe %>
                    </div>
                  <% end %>
                </div>
              </td>

              <td class="text-center align-middle">
                <% if kanji["writing_image_url"].present? %>
                  <img src="<%= kanji["writing_image_url"] %>" width="40" class="img-thumbnail shadow-sm">
                <% else %>
                  <i class="fas fa-image text-gray"></i>
                <% end %>
              </td>

              <td class="text-center align-middle">
                <div class="btn-group shadow-sm">
                  <%= link_to edit_admin_kanji_path(kanji["id"]), class: "btn btn-warning btn-sm" do %>
                    <i class="fas fa-edit"></i>
                  <% end %>

                  <%= button_to admin_kanji_path(kanji["id"]),
                                method: :delete,
                                data: { confirm: "Xác nhận xóa???" },
                                class: "btn btn-danger btn-sm" do %>
                    <i class="fas fa-trash"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>