<div class="card">
  <div class="card-header">
    <h3 class="card-title">Ngân Hàng Câu Hỏi</h3>
    <div class="card-tools">
      <%= link_to new_admin_question_path(type: params[:type]), class: "btn btn-primary btn-sm" do %>
        <i class="fas fa-plus"></i> Tạo Câu Hỏi Mới
      <% end %>
    </div>
  </div>

  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-12">
        <%= form_with url: admin_questions_path, method: :get, local: true, class: "form-inline" do |f| %>

          <div class="input-group input-group-sm mr-2 mb-2">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fas fa-filter"></i> Loại</span>
            </div>
            <%= f.select :type,
                         options_for_select([
                                              ['-- Tất cả loại --', ''],
                                              ['Reading (Cách đọc Hiragana)', 'READING'],
                                              ['Compound (Ghép từ vựng)', 'COMPOUND'],
                                              ['Story (Câu chuyện gợi nhớ)', 'STORY'],
                                              ['Context (Hoàn thành câu)', 'CONTEXT'],
                                              ['Odd One (Tìm chữ đúng nghĩa)', 'ODD_ONE']
                                            ], params[:type]),
                         {}, { class: "form-control", onchange: "this.form.submit()" } %>
          </div>

          <div class="input-group input-group-sm mr-2 mb-2">
            <div class="input-group-prepend">
              <span class="input-group-text bg-info text-white"><i class="fas fa-search"></i> Kanji</span>
            </div>
            <%= text_field_tag :kanji, params[:kanji],
                               class: "form-control",
                               placeholder: "VD: 学 (Học)...",
                               style: "width: 150px;" %>
            <div class="input-group-append">
              <button type="submit" class="btn btn-info">Tìm</button>
            </div>
          </div>

          <% if params[:type].present? || params[:kanji].present? %>
            <%= link_to admin_questions_path, class: "btn btn-sm btn-outline-secondary mb-2" do %>
              <i class="fas fa-sync"></i> Xóa lọc
            <% end %>
          <% end %>

        <% end %>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="thead-light">
        <tr>
          <th style="width: 50px" class="text-center">ID</th>
          <th style="width: 150px">Kanji Liên Quan</th> <th style="width: 150px">Loại Câu Hỏi</th>
          <th>Nội dung</th>
          <th>Đáp án đúng</th>
          <th style="width: 120px" class="text-center">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <% if @questions && @questions.any? %>
          <% @questions.each do |q| %>
            <tr>
              <td class="text-center"><%= q['id'] %></td>

              <td>
                <% if q['related_kanjis'].present? %>
                  <% q['related_kanjis'].each do |k| %>
                    <span class="badge badge-light border mb-1" style="font-size: 14px;">
                      <%= k['kanji'] %>
                    </span>
                  <% end %>
                <% else %>
                  <span class="text-muted small font-italic">-- Chung --</span>
                <% end %>
              </td>

              <td>
                <% badge_class = case q['question_type']
                                 when 'READING' then 'badge-info'
                                 when 'COMPOUND' then 'badge-success'
                                 when 'STORY' then 'badge-warning'
                                 when 'CONTEXT' then 'badge-primary'
                                 when 'ODD_ONE' then 'badge-secondary'
                                 else 'badge-light'
                                 end %>
                <span class="badge <%= badge_class %>" style="font-size: 0.9em;">
                  <%= q['question_type'] %>
                </span>
              </td>
              <td><%= truncate(q['question_text'], length: 60) %></td>
              <td class="text-success font-weight-bold"><%= q['correct_answer'] %></td>
              <td class="text-center">
                <div class="btn-group">
                  <%= link_to edit_admin_question_path(q['id']), class: "btn btn-sm btn-outline-primary", title: "Sửa" do %>
                    <i class="fas fa-edit"></i>
                  <% end %>

                  <%= button_to admin_question_path(q['id']), method: :delete, form: {style: 'display:inline-block;'}, class: "btn btn-sm btn-outline-danger ml-1", onclick: "return confirm('Bạn chắc chắn muốn xóa câu hỏi này?');", title: "Xóa" do %>
                    <i class="fas fa-trash"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="6" class="text-center py-5 text-muted"> <i class="fas fa-inbox fa-3x mb-3"></i><br>
              Không tìm thấy dữ liệu phù hợp
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>