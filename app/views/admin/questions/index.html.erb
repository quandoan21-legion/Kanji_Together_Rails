<div class="card shadow-sm">
  <div class="card-header bg-white py-3">
    <h3 class="card-title font-weight-bold text-dark">
      <i class="fas fa-list-ul mr-1 text-primary"></i> Ngân Hàng Câu Hỏi
    </h3>
    <div class="card-tools">
      <%= link_to new_admin_question_path(type: params[:type]), class: "btn btn-primary btn-sm rounded-pill px-3 shadow-sm" do %>
        <i class="fas fa-plus"></i> Tạo Câu Hỏi Mới
      <% end %>
    </div>
  </div>

  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-12">
        <%= form_with url: admin_questions_path, method: :get, local: true, class: "form-inline" do |f| %>
          <div class="input-group input-group-sm mr-2 mb-2">
            <div class="input-group-prepend">
              <span class="input-group-text font-weight-bold bg-light">Loại</span>
            </div>
            <%= f.select :type, options_for_select([['-- Tất cả --', ''], ['Reading', 'READING'], ['Compound', 'COMPOUND'], ['Story', 'STORY'], ['Context', 'CONTEXT'], ['Odd One', 'ODD_ONE']], params[:type]), {}, { class: "form-control", onchange: "this.form.submit()" } %>
          </div>
          <div class="input-group input-group-sm mr-2 mb-2">
            <%= text_field_tag :kanji, params[:kanji], class: "form-control", placeholder: "Tìm kiếm..." %>
            <div class="input-group-append">
              <button type="submit" class="btn btn-info px-3">Tìm</button>
            </div>
          </div>
          <% if params[:type].present? || params[:kanji].present? %>
            <%= link_to admin_questions_path, class: "btn btn-sm btn-outline-danger mb-2 ml-2 border-0" do %>
              <i class="fas fa-times"></i> Xóa lọc
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover m-0 custom-table">
        <thead class="thead-light text-center"> <tr>
          <th style="width: 70px" class="font-weight-bold">ID</th>
          <th style="width: 140px" class="font-weight-bold">Loại</th>
          <th class="font-weight-bold">Nội dung câu hỏi</th>
          <th style="width: 220px" class="font-weight-bold">Đáp án đúng</th>
          <th style="width: 160px" class="font-weight-bold">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <% if @questions && @questions.any? %>
          <% @questions.each do |q| %>
            <tr style="height: 70px;"> <td class="text-center font-weight-bold text-muted align-middle"><%= q['id'] %></td>
              <td class="text-center align-middle">
                <span class="badge badge-info p-2 shadow-xs" style="font-size: 0.9rem;"><%= q['question_type'] || q['questionType'] %></span>
              </td>
              <td class="align-middle px-3"><%= truncate(q['question_text'] || q['questionText'], length: 80) %></td>
              <td class="text-success font-weight-bold align-middle px-3">
                <i class="fas fa-check-circle mr-1"></i><%= q['correct_answer'] || q['correctAnswer'] %>
              </td>
              <td class="text-center align-middle">
                <div class="btn-group">
                  <%= link_to admin_question_path(q['id']), class: "btn btn-sm btn-info rounded-circle mr-2", title: "Xem" do %><i class="fas fa-eye"></i><% end %>
                  <%= link_to edit_admin_question_path(q['id']), class: "btn btn-sm btn-outline-primary rounded-circle mr-2", title: "Sửa" do %><i class="fas fa-edit"></i><% end %>
                  <%= button_to admin_question_path(q['id']), method: :delete, class: "btn btn-sm btn-outline-danger rounded-circle", onclick: "return confirm('Xóa câu hỏi này?')" do %><i class="fas fa-trash"></i><% end %>
                </div>
              </td>
            </tr>
          <% end %>

          <%# Logic bù dòng trống %>
          <% (10 - @questions.size).times do %>
            <tr style="height: 70px;">
              <td colspan="5" style="background-color: #fdfdfd; border-color: #eee;">&nbsp;</td>
            </tr>
          <% end %>
        <% else %>
          <tr><td colspan="5" class="text-center py-5 text-muted">Không tìm thấy dữ liệu câu hỏi nào.</td></tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card-footer bg-white py-4">
    <div class="d-flex flex-column align-items-center">
      <div class="mb-3">
        <span class="badge badge-light border shadow-sm px-4 py-2 rounded-pill text-muted" style="font-size: 0.95rem;">
          Trang <b class="text-primary"><%= @current_page %></b> / <%= @total_pages %>
          <span class="mx-2 text-muted opacity-50">|</span>
          Tổng cộng <b class="text-dark text-lg"><%= @total_elements %></b> câu hỏi
        </span>
      </div>

      <% if @total_pages.to_i > 1 %>
        <nav>
          <ul class="pagination m-0 custom-pagination">
            <li class="page-item mx-1 <%= 'disabled' if @current_page <= 1 %>">
              <%= link_to admin_questions_path(page: @current_page - 1, type: params[:type], kanji: params[:kanji]), class: "page-link rounded-circle shadow-sm border-0" do %>
                <i class="fas fa-chevron-left"></i>
              <% end %>
            </li>

            <% (1..@total_pages).each do |p| %>
              <% if p == 1 || p == @total_pages || (p - @current_page).abs <= 1 %>
                <li class="page-item mx-1 <%= 'active' if p == @current_page %>">
                  <%= link_to p, admin_questions_path(page: p, type: params[:type], kanji: params[:kanji]), class: "page-link rounded-circle shadow-sm border-0" %>
                </li>
              <% elsif (p - @current_page).abs == 2 %>
                <li class="page-item mx-1 disabled"><span class="page-link border-0 bg-transparent">...</span></li>
              <% end %>
            <% end %>

            <li class="page-item mx-1 <%= 'disabled' if @current_page >= @total_pages %>">
              <%= link_to admin_questions_path(page: @current_page + 1, type: params[:type], kanji: params[:kanji]), class: "page-link rounded-circle shadow-sm border-0" do %>
                <i class="fas fa-chevron-right"></i>
              <% end %>
            </li>
          </ul>
        </nav>
      <% end %>
    </div>
  </div>
</div>

<style>
    /* TĂNG FONT CHỮ TO TOÀN BẢNG */
    .custom-table th, .custom-table td {
        font-size: 1.05rem; /* Cỡ chữ to hơn một chút */
        vertical-align: middle !important;
    }

    .custom-pagination .page-link {
        width: 42px;
        height: 42px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #5a5a5a;
        transition: all 0.2s ease-in-out;
        background-color: #fff;
        font-size: 1rem;
    }

    .custom-pagination .page-link:hover {
        background-color: #007bff;
        color: #fff !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0,123,255,0.2) !important;
    }

    .custom-pagination .page-item.active .page-link {
        background-color: #007bff !important;
        color: #fff !important;
        box-shadow: 0 4px 12px rgba(0,123,255,0.3) !important;
    }

    .custom-pagination .page-item.disabled .page-link {
        background-color: #f8f9fa;
        color: #ccc;
    }

    .shadow-xs { box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
</style>